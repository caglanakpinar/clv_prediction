
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="lifetime Value for Engaged Customers and New Comers">
      
      
      
        <link rel="canonical" href="https://github.com/caglanakpinar/clv_prediction/data_preprocess/">
      
      
        <link rel="prev" href="../data_access/">
      
      
        <link rel="next" href="../train/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>pre-process - Customer Lifetime Value Prediction</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-preprocess" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Customer Lifetime Value Prediction" class="md-header__button md-logo" aria-label="Customer Lifetime Value Prediction" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Customer Lifetime Value Prediction
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pre-process
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/caglanakpinar/clv_prediction" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    clv_prediction
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Customer Lifetime Value Prediction" class="md-nav__button md-logo" aria-label="Customer Lifetime Value Prediction" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Customer Lifetime Value Prediction
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/caglanakpinar/clv_prediction" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    clv_prediction
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    getting started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    how to run
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    configurations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../data_access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    data access
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    pre-process
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    pre-process
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-next-purchase-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Next Purchase Model Data Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-purchase-amount-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Purchase Amount Model Data Preparation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Purchase Amount Model Data Preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-order-count-as-a-feature-at-purchase-amount-model" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need order count as a feature at Purchase Amount Model?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why do we need order count as a feature at Purchase Amount Model?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caution" class="md-nav__link">
    <span class="md-ellipsis">
      Caution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-we-need-an-order-count-of-a-decision" class="md-nav__link">
    <span class="md-ellipsis">
      Why we need an order count of a decision?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-newcomers-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      3. NewComers Model Data Preparation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. NewComers Model Data Preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-order-count-as-a-feature-at-newcomers-clv-model" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need order count as a feature at NewComers CLV Model?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../train/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    train
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hyperparameters
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    monitoring
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-next-purchase-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Next Purchase Model Data Preparation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-purchase-amount-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Purchase Amount Model Data Preparation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Purchase Amount Model Data Preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-order-count-as-a-feature-at-purchase-amount-model" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need order count as a feature at Purchase Amount Model?
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Why do we need order count as a feature at Purchase Amount Model?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caution" class="md-nav__link">
    <span class="md-ellipsis">
      Caution
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-we-need-an-order-count-of-a-decision" class="md-nav__link">
    <span class="md-ellipsis">
      Why we need an order count of a decision?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-newcomers-model-data-preparation" class="md-nav__link">
    <span class="md-ellipsis">
      3. NewComers Model Data Preparation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. NewComers Model Data Preparation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-do-we-need-order-count-as-a-feature-at-newcomers-clv-model" class="md-nav__link">
    <span class="md-ellipsis">
      Why do we need order count as a feature at NewComers CLV Model?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="data-preprocess">Data Preprocess</h1>
<p>Each model has unique aggregation in order to prepare data to create model.</p>
<h2 id="1-next-purchase-model-data-preparation">1. Next Purchase Model Data Preparation</h2>
<p>Time difference of each order per customer is calculated as day difference of orders per user.
Normalized each time difference values related to Min-Max Normalization Method. Each customer of Min-Max Normalization individually.
number of lag parameter is tuned by using ARIMA time series model.
Regarding of <em>lahead</em> parameter of LSTM model, data set is shaped per customer.
Iteratively each customer of data set is collected individually. the process is parallelized according to CPU count.
When model data has been prepared per customer, 
it is split according to split ratio into the train and test data set (train_x, train_y, test_x, test_y).</p>
<table>
<thead>
<tr>
<th style="text-align: right;">customers</th>
<th style="text-align: right;">lag 3</th>
<th style="text-align: right;">lag 2</th>
<th style="text-align: right;">lag 1</th>
<th style="text-align: right;">y</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">0,4</td>
<td style="text-align: right;">0,8</td>
<td style="text-align: right;">1,7</td>
<td style="text-align: right;">1,2</td>
</tr>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">0,8</td>
<td style="text-align: right;">1,7</td>
<td style="text-align: right;">1,2</td>
<td style="text-align: right;">1,4</td>
</tr>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">1,7</td>
<td style="text-align: right;">1,2</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,6</td>
</tr>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">1,2</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,6</td>
<td style="text-align: right;">2,8</td>
</tr>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,6</td>
<td style="text-align: right;">2,8</td>
<td style="text-align: right;">2,9</td>
</tr>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">1,6</td>
<td style="text-align: right;">2,8</td>
<td style="text-align: right;">2,9</td>
<td style="text-align: right;">3,0</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,4</td>
<td style="text-align: right;">5,8</td>
<td style="text-align: right;">5,7</td>
<td style="text-align: right;">5,2</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,8</td>
<td style="text-align: right;">5,7</td>
<td style="text-align: right;">5,2</td>
<td style="text-align: right;">5,4</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,7</td>
<td style="text-align: right;">5,2</td>
<td style="text-align: right;">5,4</td>
<td style="text-align: right;">5,6</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,2</td>
<td style="text-align: right;">5,4</td>
<td style="text-align: right;">5,6</td>
<td style="text-align: right;">5,8</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,4</td>
<td style="text-align: right;">5,6</td>
<td style="text-align: right;">5,8</td>
<td style="text-align: right;">5,9</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">5,6</td>
<td style="text-align: right;">5,8</td>
<td style="text-align: right;">5,9</td>
<td style="text-align: right;">5,0</td>
</tr>
</tbody>
</table>
<h2 id="2-purchase-amount-model-data-preparation">2. Purchase Amount Model Data Preparation</h2>
<p><code>order_count</code> parameter refers us for the model of the feature count. 
previous orders of purchase amounts of each customer is collected from fow data.
Regarding of <code>lahead</code> parameter of LSTM model, data set is shaped per customer.
Iteratively each customer of data set is collected individually. the process is parallelized according to CPU count.
When model data has been prepared per customer, 
it is split according to split ratio into the train and test data set (train_x, train_y, test_x, test_y).</p>
<h3 id="why-do-we-need-order-count-as-a-feature-at-purchase-amount-model">Why do we need order count as a feature at Purchase Amount Model?</h3>
<p>Order count is also the feature number of the purchase amount model.</p>
<h4 id="caution">Caution</h4>
<p>Order count must be inserted into the <code>test_parameters.yaml</code> in order not to allow for changing later on prediction. 
Once the model is built with calculated <code>order_count</code> it must be predicted with the same order count.</p>
<h3 id="why-we-need-an-order-count-of-a-decision">Why we need an order count of a decision?</h3>
<p>It is a crucial parameter for the purchase amount model. 
The purchase amount is a 1 Dimensional Conv NN. It works with kernel sizes and they are related to feature size.
At the purchase amount model features are sequential orders. 
For instance if we assign order count as 5, time_period.user_1, user_2, user_3, user_4 have 100, 101, 300, 2 orders.
The data set will be;</p>
<ul>
<li>
<p><code>user_1: 95th, 96th, 97th, 98th, 99th, 100th  orders</code></p>
</li>
<li>
<p><code>user_2: 96th, 97th, 98th, 99th, q00th, 101st  orders</code></p>
</li>
<li>
<p><code>user_3: 295th, 296th, 297th, 298th, 299th, 300th  orders</code></p>
</li>
<li>
<p><code>user_4: only have 2 orders first 9 orders will be 0 and this will affect the model process</code></p>
</li>
</ul>
<p>It is now crucial to have a minimum 0 assigned order as user_4
However, it is also a crucial point to get as much previous order count for make kernel size larger.
The order count must be optimized even sending to the platform as an argument. 
If this argument is not using, the platform handles for deciding order_count***.</p>
<table>
<thead>
<tr>
<th style="text-align: right;">customers</th>
<th style="text-align: right;">Last 5</th>
<th style="text-align: right;">Last 4</th>
<th style="text-align: right;">Last 3</th>
<th style="text-align: right;">Last 2</th>
<th style="text-align: right;">Last Order (y)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">user_1</td>
<td style="text-align: right;">10,4</td>
<td style="text-align: right;">13,4</td>
<td style="text-align: right;">18,4</td>
<td style="text-align: right;">11,4</td>
<td style="text-align: right;">15,4</td>
</tr>
<tr>
<td style="text-align: right;">user_2</td>
<td style="text-align: right;">50,8</td>
<td style="text-align: right;">52,8</td>
<td style="text-align: right;">54,8</td>
<td style="text-align: right;">56,8</td>
<td style="text-align: right;">58,8</td>
</tr>
<tr>
<td style="text-align: right;">user_3</td>
<td style="text-align: right;">30,7</td>
<td style="text-align: right;">25,7</td>
<td style="text-align: right;">15,7</td>
<td style="text-align: right;">10,7</td>
<td style="text-align: right;">8,7</td>
</tr>
<tr>
<td style="text-align: right;">user_4</td>
<td style="text-align: right;">20,2</td>
<td style="text-align: right;">23.5</td>
<td style="text-align: right;">26,2</td>
<td style="text-align: right;">27,2</td>
<td style="text-align: right;">29,2</td>
</tr>
<tr>
<td style="text-align: right;">user_5</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,4</td>
<td style="text-align: right;">1,4</td>
</tr>
<tr>
<td style="text-align: right;">user_6</td>
<td style="text-align: right;">12,6</td>
<td style="text-align: right;">30,6</td>
<td style="text-align: right;">12,6</td>
<td style="text-align: right;">30,6</td>
<td style="text-align: right;">12,6</td>
</tr>
</tbody>
</table>
<h2 id="3-newcomers-model-data-preparation">3. NewComers Model Data Preparation</h2>
<p><code>order_count</code> argument will be used in order to assign users weather NewComer pr not. 
THis parameter can be while initializing the platform as below;</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>    from clv.executor import CLV
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    order_count = 3  # users who have &lt; 3 orders will be new comers
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    clv = CLV(customer_indicator=customer_indicator,
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>              ...
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>              order_count: int | None, 
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>              ....
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    )
</code></pre></div>
<p>If <code>order_count=None</code>, <code>feature_count</code> in <code>test_parameters.yaml</code> will be used.</p>
<h3 id="why-do-we-need-order-count-as-a-feature-at-newcomers-clv-model">Why do we need order count as a feature at NewComers CLV Model?</h3>
<p>It is a crucial parameter for NewComers Model;</p>
<ul>
<li>
<p>Users who have an order count less than <code>order_count</code> are not included in Combined of Next Purchase - Purchase Amount Models.</p>
</li>
<li>
<p>NewComers are individually predicted according to a dependent value is <code>order_count</code>.</p>
</li>
</ul>
<p>Main concept of Newcomers is for predicting orders count daily.
Feature value is going to be total number of order count for all NewComers.
Normalized each order count values related to Min-Max Normalization Method per day.
Regarding of <code>lahead</code> parameter of LSTM model, data set is shaped just like below;</p>
<table>
<thead>
<tr>
<th style="text-align: right;">days</th>
<th style="text-align: right;">lag 3</th>
<th style="text-align: right;">lag 2</th>
<th style="text-align: right;">lag 1</th>
<th style="text-align: right;">y  (total order count of Newcomers)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">2021-05-01</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-02</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-03</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">40</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-04</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">60</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-05</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">70</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-06</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">90</td>
</tr>
<tr>
<td style="text-align: right;">2021-05-07</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">100</td>
</tr>
</tbody>
</table>
<p>When model data has been prepared per day just like above.
it is split according to split ratio into the train and test data set (train_x, train_y, test_x, test_y).
LSTM model will be implemented for the data just like above.</p>
<p>Prediction process is calculated sequentially per day. Each day model has been regenerated (store .json format) 
with updated coefficient matrix (stored as .h5 format).
LSTM allows us to predict next step values regarding your lags. While we are predicting further prediction,
models of coefficients must be updated and the previous prediction values must be merged just like actual values.
But, just like the recent prediction and model, the Tuned parameters are will also be used for further future days of predictions.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["instant", "navigation.expand", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>